<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.24.xsd">

    <changeSet id="003-create-indexes" author="od46s-dev">
        <comment>Criação de índices para otimização de consultas</comment>
        
        <!-- Índices para consultas frequentes de usuários -->
        <createIndex tableName="usuarios" indexName="idx_usuarios_email">
            <column name="email"/>
        </createIndex>
        
        <createIndex tableName="usuarios" indexName="idx_usuarios_ativo">
            <column name="ativo"/>
        </createIndex>
        
        <!-- Índices para motoristas -->
        <createIndex tableName="motoristas" indexName="idx_motoristas_habilitado">
            <column name="habilitado"/>
        </createIndex>
        
        <!-- Índices para veículos -->
        <createIndex tableName="veiculos" indexName="idx_veiculos_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="veiculos" indexName="idx_veiculos_ativo">
            <column name="ativo"/>
        </createIndex>
        
        <!-- Índices para rotas -->
        <createIndex tableName="rotas" indexName="idx_rotas_ativa">
            <column name="ativa"/>
        </createIndex>
        
        <createIndex tableName="rotas" indexName="idx_rotas_tipo_coleta">
            <column name="tipo_coleta"/>
        </createIndex>
        
        <createIndex tableName="rotas" indexName="idx_rotas_data_criacao">
            <column name="data_criacao"/>
        </createIndex>
        
        <!-- Índices para pontos de coleta -->
        <createIndex tableName="rota_pontos_coleta" indexName="idx_pontos_rota_ordem">
            <column name="rota_id"/>
            <column name="ordem_sequencia"/>
        </createIndex>
        
        <createIndex tableName="rota_pontos_coleta" indexName="idx_pontos_coordenadas">
            <column name="latitude"/>
            <column name="longitude"/>
        </createIndex>
        
        <!-- Índices para execuções -->
        <createIndex tableName="execucoes_rota" indexName="idx_execucoes_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="execucoes_rota" indexName="idx_execucoes_data_inicio">
            <column name="data_inicio"/>
        </createIndex>
        
        <createIndex tableName="execucoes_rota" indexName="idx_execucoes_motorista_data">
            <column name="motorista_id"/>
            <column name="data_inicio"/>
        </createIndex>
        
        <createIndex tableName="execucoes_rota" indexName="idx_execucoes_veiculo_data">
            <column name="veiculo_id"/>
            <column name="data_inicio"/>
        </createIndex>
        
        <!-- Índices para registros GPS -->
        <createIndex tableName="registros_gps" indexName="idx_gps_execucao_timestamp">
            <column name="execucao_id"/>
            <column name="timestamp_gps"/>
        </createIndex>
        
        <createIndex tableName="registros_gps" indexName="idx_gps_coordenadas">
            <column name="latitude"/>
            <column name="longitude"/>
        </createIndex>
        
        <!-- Índices para registros de coleta -->
        <createIndex tableName="registros_coleta_pontos" indexName="idx_coleta_execucao_timestamp">
            <column name="execucao_id"/>
            <column name="timestamp_coleta"/>
        </createIndex>
        
        <createIndex tableName="registros_coleta_pontos" indexName="idx_coleta_status">
            <column name="status_coleta"/>
        </createIndex>

        <rollback>
            <dropIndex tableName="usuarios" indexName="idx_usuarios_email"/>
            <dropIndex tableName="usuarios" indexName="idx_usuarios_ativo"/>
            <dropIndex tableName="motoristas" indexName="idx_motoristas_habilitado"/>
            <dropIndex tableName="veiculos" indexName="idx_veiculos_status"/>
            <dropIndex tableName="veiculos" indexName="idx_veiculos_ativo"/>
            <dropIndex tableName="rotas" indexName="idx_rotas_ativa"/>
            <dropIndex tableName="rotas" indexName="idx_rotas_tipo_coleta"/>
            <dropIndex tableName="rotas" indexName="idx_rotas_data_criacao"/>
            <dropIndex tableName="rota_pontos_coleta" indexName="idx_pontos_rota_ordem"/>
            <dropIndex tableName="rota_pontos_coleta" indexName="idx_pontos_coordenadas"/>
            <dropIndex tableName="execucoes_rota" indexName="idx_execucoes_status"/>
            <dropIndex tableName="execucoes_rota" indexName="idx_execucoes_data_inicio"/>
            <dropIndex tableName="execucoes_rota" indexName="idx_execucoes_motorista_data"/>
            <dropIndex tableName="execucoes_rota" indexName="idx_execucoes_veiculo_data"/>
            <dropIndex tableName="registros_gps" indexName="idx_gps_execucao_timestamp"/>
            <dropIndex tableName="registros_gps" indexName="idx_gps_coordenadas"/>
            <dropIndex tableName="registros_coleta_pontos" indexName="idx_coleta_execucao_timestamp"/>
            <dropIndex tableName="registros_coleta_pontos" indexName="idx_coleta_status"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
